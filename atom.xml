<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Ariel&#39;s Blog</title>
  
  <subtitle>我想在那里最蓝的大海扬帆 , 绝不管自己能不能回还</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-04-11T03:16:17.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Ariel</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux学习笔记二：文件与目录管理</title>
    <link href="http://yoursite.com/2018/03/29/Linux-file-directory-manage/"/>
    <id>http://yoursite.com/2018/03/29/Linux-file-directory-manage/</id>
    <published>2018-03-29T07:01:58.000Z</published>
    <updated>2018-04-11T03:16:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目录与路径"><a href="#目录与路径" class="headerlink" title="目录与路径"></a>目录与路径</h1><h2 id="目录的相关操作"><a href="#目录的相关操作" class="headerlink" title="目录的相关操作"></a>目录的相关操作</h2><p>首先介绍一下比较特殊的目录，需要牢记脑海：</p><table><thead><tr><th style="text-align:left">目录</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">.</td><td style="text-align:left">代表此层目录</td></tr><tr><td style="text-align:left">..</td><td style="text-align:left">代表上一层目录</td></tr><tr><td style="text-align:left">-</td><td style="text-align:left">代表前一个工作目录</td></tr><tr><td style="text-align:left">~</td><td style="text-align:left">代表【目前用户身份】所在的家目录</td></tr><tr><td style="text-align:left">~arieltian</td><td style="text-align:left">代表 arieltian 这个用户的家目录</td></tr></tbody></table><p>需要注意的是：<strong>在所有目录底下都会存在<code>.</code>和<code>..</code>两个目录</strong>，根目录的上一层<code>..</code>和根目录自己<code>.</code>是同一个目录。然后再了解下几个常见的目录操作指令</p><ul><li>cd：变换目录</li><li>pwd：显示当前目录</li><li>mkdir：建立一个新的目录</li><li>rmdir：删除一个空目录</li></ul><h3 id="cd-change-directory"><a href="#cd-change-directory" class="headerlink" title="cd(change directory)"></a>cd(change directory)</h3><p>用来切换工作目录的指令。结合上文讲到的<code>目录及含义</code>和<code>相对路径与绝对路径</code>，相信大家能够轻松的进行目录切换了。</p><h3 id="pwd-print-working-directory"><a href="#pwd-print-working-directory" class="headerlink" title="pwd(print working directory)"></a>pwd(print working directory)</h3><p>显示当前工作目录，该指令有可选参数：[-P]，使用该参数后，显示的是当前确切路径，而非链接(link)路径。如下图，/var/log是链接文档，链接到/private/var/log<br><img src="/images/2018-03-29-Linux-file-directory-manage/pwd.png" alt="显示当前工作目录"></p><a id="more"></a><h3 id="mkdir-make-directory"><a href="#mkdir-make-directory" class="headerlink" title="mkdir(make directory)"></a>mkdir(make directory)</h3><p>建立新目录，有可选参数[-mp]，<code>-m</code>配置文件目录的权限，<code>-p</code>可直接递归创建目录（预设情况下，所需目录得一层一层创建）。<br><img src="/images/2018-03-29-Linux-file-directory-manage/mkdir.png" alt="创建新目录"></p><h3 id="rmdir-remove-directory"><a href="#rmdir-remove-directory" class="headerlink" title="rmdir(remove directory)"></a>rmdir(remove directory)</h3><p>删除空目录，有可选参数[-p]，<code>-p</code>可递归删除层级目录。需要注意的是，<strong>rmdir仅可删除空目录，当目标目录存在下级目录或文件时，该指令会执行失败，如果要强制删除目标目录以及该目录下的所有目录/文件，可使用【rm -r 目标目录】指令</strong><br><img src="/images/2018-03-29-Linux-file-directory-manage/rmdir.png" alt="删除空目录"></p><h2 id="执行文件路径的变量：-PATH"><a href="#执行文件路径的变量：-PATH" class="headerlink" title="执行文件路径的变量：$PATH"></a>执行文件路径的变量：$PATH</h2><p>以查阅文件属性的指令<code>ls</code>为例，它的完整文件名为：<code>/bin/ls</code>（绝对路径），但是我们在任何一个目录下执行<code>ls</code>指令都会输出信息，而不会发生<strong>找不到/bin/ls指令</strong>的错误，这其实是在环境变量<code>PATH</code>的帮助下完成的。<br><img src="/images/2018-03-29-Linux-file-directory-manage/$PATH.png" alt="$PATH"></p><p>当我们在执行<code>ls</code>时，系统会按照PATH的设定去每个PATH定义的目录下搜寻名为<code>ls</code>的可执行文件，如果在PATH定义的目录中含有多个ls可执行文件，先搜寻到的ls指令先被执行</p><h1 id="文件与目录管理"><a href="#文件与目录管理" class="headerlink" title="文件与目录管理"></a>文件与目录管理</h1><h2 id="文件与目录的检视：ls"><a href="#文件与目录的检视：ls" class="headerlink" title="文件与目录的检视：ls"></a>文件与目录的检视：ls</h2><p>Linux的文件记录的信息其实是非常多的，默认情况下（ls指令不附加参数）显示的文件信息只包括：非隐藏的档名、以档名进行排序及文件名代表的颜色显示。当我们需要知道文件的其他信息时，需要附加额外的参数，具体参数及各自代表的意义如下表：  </p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">-a</td><td style="text-align:left">全部的文件，连同隐藏档一起列出来</td></tr><tr><td style="text-align:left">-A</td><td style="text-align:left">全部的文件，连同隐藏档一起列出来，但不包括<code>.</code>与<code>..</code>这两个目录</td></tr><tr><td style="text-align:left">-d</td><td style="text-align:left">仅列出目录本身，而不是列出目录内的文件数据</td></tr><tr><td style="text-align:left">-f</td><td style="text-align:left">直接列出结果，而不进行排序</td></tr><tr><td style="text-align:left">-F</td><td style="text-align:left">根据文件、目录等信息，给予附加数据结构。</td></tr><tr><td style="text-align:left">-h</td><td style="text-align:left">将文件容量已易读的方式（如GB、KB等）列出来</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">列出inode号</td></tr><tr><td style="text-align:left">-l</td><td style="text-align:left">长数据串行出，包含文件的属性与权限等等数据</td></tr><tr><td style="text-align:left">-n</td><td style="text-align:left">列出UID与GID而非使用者与群组的名称</td></tr><tr><td style="text-align:left">-r</td><td style="text-align:left">将排序结果反向输出</td></tr><tr><td style="text-align:left">-R</td><td style="text-align:left">连同子目录内容一起列出来，等于该目录下的所有文件都会显示出来</td></tr><tr><td style="text-align:left">-S</td><td style="text-align:left">以文件容量大小排序</td></tr><tr><td style="text-align:left">-t</td><td style="text-align:left">依时间排序</td></tr></tbody></table><h2 id="复制、删除与移动：cp、rm、mv"><a href="#复制、删除与移动：cp、rm、mv" class="headerlink" title="复制、删除与移动：cp、rm、mv"></a>复制、删除与移动：cp、rm、mv</h2><h3 id="cp（复制文件或目录）"><a href="#cp（复制文件或目录）" class="headerlink" title="cp（复制文件或目录）"></a>cp（复制文件或目录）</h3><p>其指令格式为<code>cp [-adfilprsu] source(来源文件) destination(目标文件)</code>，不同身份的用户执行该指令会有不同的结果产生。cp指令可附加的选项与参数如下表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">-a</td><td style="text-align:left">相当于 -dr –preserve=all的意思，dr请参考下列说明</td></tr><tr><td style="text-align:left">-d</td><td style="text-align:left">若来源文件为链接文件的属性，则复制链接文件属性而非文件本身</td></tr><tr><td style="text-align:left">-f</td><td style="text-align:left">为强制（force）的意思，若目标文件已经存在且无法开启，则移除后再尝试一次</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">若目标文件已经存在时，在覆盖时会先询问动作的进行</td></tr><tr><td style="text-align:left">-l</td><td style="text-align:left">进行硬式连结的连接档建立，而非复制文件本身</td></tr><tr><td style="text-align:left">-p</td><td style="text-align:left">连同文件的属性一起复制过去，而非使用默认属性</td></tr><tr><td style="text-align:left">-r</td><td style="text-align:left">递归持续复制，用于目录的复制行为</td></tr><tr><td style="text-align:left">-s</td><td style="text-align:left">复制成为富豪链接文件，亦即[快捷方式]文件</td></tr><tr><td style="text-align:left">-u</td><td style="text-align:left">destination比source 旧才更新destination，或destination不存在才复制</td></tr></tbody></table><p>需要注意的是：<strong>在预设条件中，cp的来源文件与目标文件的权限是不同的，目标文件的拥有者通常是指令执行者本身</strong>，因此当我们进行备份的时候，一些特殊权限的文件（比如密码文件/etc/sahdow）以及一些配置文件，就需要加上-a或者-p等可以完整复制文件权限的选项才行。来看看实际应用：<br><img src="/images/2018-03-29-Linux-file-directory-manage/cp.png" alt="cp"><br>由于arieltian的身份并不能随意修改文件的拥有者与群组，因此即使加上 -a 选项，也只能复制源文件的相关权限与时间等属性，而不能复制与拥有者、群组相关的权限的。</p><h3 id="rm（移除文件或目录）"><a href="#rm（移除文件或目录）" class="headerlink" title="rm（移除文件或目录）"></a>rm（移除文件或目录）</h3><p>指令格式为<code>rm [-fir] 文件或目录</code>，可选参数如下：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">-f</td><td style="text-align:left">为force的意思，忽略不存在的文件，不会出现警告信息</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">在删除前会询问使用者是否执行</td></tr><tr><td style="text-align:left">-r</td><td style="text-align:left">递归删除，常用于目录的删除</td></tr></tbody></table><p>来看看实际应用：<br><img src="/images/2018-03-29-Linux-file-directory-manage/rm.png" alt="rm"></p><h3 id="mv（移动文件与目录，或重命名）"><a href="#mv（移动文件与目录，或重命名）" class="headerlink" title="mv（移动文件与目录，或重命名）"></a>mv（移动文件与目录，或重命名）</h3><p>指令格式为<code>mv [-fiu] 文件或目录</code>，可选参数如下：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">-f</td><td style="text-align:left">为force的意思，若目标文件已存在，不会询问而直接覆盖</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">若目标文件已存在，会询问是否覆盖</td></tr><tr><td style="text-align:left">-u</td><td style="text-align:left">若目标文件已存在，且source比较新才更新目标文件</td></tr></tbody></table><p>实际应用如下：<br><img src="/images/2018-03-29-Linux-file-directory-manage/mv.png" alt="mv"></p><h2 id="获取路径的文件名与目录名"><a href="#获取路径的文件名与目录名" class="headerlink" title="获取路径的文件名与目录名"></a>获取路径的文件名与目录名</h2><p>一个文件的完整档名包含前面的目录与最终的文件名，在shell script之类的程序中，怎么知道某个完整档名里，哪部分是档名，哪部分是目录名呢？以一个范例来看看basename与dirname的用途：<br><img src="/images/2018-03-29-Linux-file-directory-manage/basename.png" alt="basename"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;目录与路径&quot;&gt;&lt;a href=&quot;#目录与路径&quot; class=&quot;headerlink&quot; title=&quot;目录与路径&quot;&gt;&lt;/a&gt;目录与路径&lt;/h1&gt;&lt;h2 id=&quot;目录的相关操作&quot;&gt;&lt;a href=&quot;#目录的相关操作&quot; class=&quot;headerlink&quot; title=&quot;目录的相关操作&quot;&gt;&lt;/a&gt;目录的相关操作&lt;/h2&gt;&lt;p&gt;首先介绍一下比较特殊的目录，需要牢记脑海：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;目录&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;.&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;代表此层目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;..&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;代表上一层目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;-&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;代表前一个工作目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;~&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;代表【目前用户身份】所在的家目录&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;~arieltian&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;代表 arieltian 这个用户的家目录&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;需要注意的是：&lt;strong&gt;在所有目录底下都会存在&lt;code&gt;.&lt;/code&gt;和&lt;code&gt;..&lt;/code&gt;两个目录&lt;/strong&gt;，根目录的上一层&lt;code&gt;..&lt;/code&gt;和根目录自己&lt;code&gt;.&lt;/code&gt;是同一个目录。然后再了解下几个常见的目录操作指令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cd：变换目录&lt;/li&gt;
&lt;li&gt;pwd：显示当前目录&lt;/li&gt;
&lt;li&gt;mkdir：建立一个新的目录&lt;/li&gt;
&lt;li&gt;rmdir：删除一个空目录&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;cd-change-directory&quot;&gt;&lt;a href=&quot;#cd-change-directory&quot; class=&quot;headerlink&quot; title=&quot;cd(change directory)&quot;&gt;&lt;/a&gt;cd(change directory)&lt;/h3&gt;&lt;p&gt;用来切换工作目录的指令。结合上文讲到的&lt;code&gt;目录及含义&lt;/code&gt;和&lt;code&gt;相对路径与绝对路径&lt;/code&gt;，相信大家能够轻松的进行目录切换了。&lt;/p&gt;
&lt;h3 id=&quot;pwd-print-working-directory&quot;&gt;&lt;a href=&quot;#pwd-print-working-directory&quot; class=&quot;headerlink&quot; title=&quot;pwd(print working directory)&quot;&gt;&lt;/a&gt;pwd(print working directory)&lt;/h3&gt;&lt;p&gt;显示当前工作目录，该指令有可选参数：[-P]，使用该参数后，显示的是当前确切路径，而非链接(link)路径。如下图，/var/log是链接文档，链接到/private/var/log&lt;br&gt;&lt;img src=&quot;/images/2018-03-29-Linux-file-directory-manage/pwd.png&quot; alt=&quot;显示当前工作目录&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Roadmap to becoming a web developer in 2018</title>
    <link href="http://yoursite.com/2018/02/27/Roadmap-to-becoming-a-web-developer-in-2018/"/>
    <id>http://yoursite.com/2018/02/27/Roadmap-to-becoming-a-web-developer-in-2018/</id>
    <published>2018-02-27T09:12:06.000Z</published>
    <updated>2018-02-27T09:35:25.089Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.imgur.com/oxsayps.png" alt="Web Developer Roadmap"></p><blockquote><p>Roadmap to becoming a web developer in 2018</p><p>There is a <a href="https://www.youtube.com/watch?v=wdjvfPMZ7hg" target="_blank" rel="noopener">recorded version of this on youtube now</a>. Also, I just created this channel and <a href="https://github.com/hugobots/we-want" target="_blank" rel="noopener">have got some nice plans for the screencasts</a> so make sure to <a href="https://www.youtube.com/c/kamranahmed_se" target="_blank" rel="noopener">subscribe to the channel</a>, if you would like :)</p></blockquote><p>Below you find a set of charts demonstrating the paths that you can take and the technologies that you would want to adopt in order to become a frontend, backend or a devops. I made these charts for an old professor of mine who wanted something to share with his college students to give them a perspective.</p><p>If you think that these can be improved in anyway, please do suggest.</p><hr><p align="center"><b> Did you like this guide and want more of the similar content? </b><br>Subscribe for the launch of <a href="http://hugobots.com" target="_blank" rel="noopener">Hugobots</a> or <a href="http://twitter.com/kamranahmedse" target="_blank" rel="noopener">follow me on twitter</a>!</p><hr><a id="more"></a><h2 id="🚀-Introduction"><a href="#🚀-Introduction" class="headerlink" title="🚀 Introduction"></a>🚀 Introduction</h2><p><img src="https://i.imgur.com/OZUOUtI.png" alt=""></p><h2 id="🎨-Front-end-Roadmap"><a href="#🎨-Front-end-Roadmap" class="headerlink" title="🎨 Front-end Roadmap"></a>🎨 Front-end Roadmap</h2><p><img src="https://i.imgur.com/WrfLESm.png" alt=""></p><h2 id="👽-Back-end-Roadmap"><a href="#👽-Back-end-Roadmap" class="headerlink" title="👽 Back-end Roadmap"></a>👽 Back-end Roadmap</h2><p>For the backend, personally I would prefer Node.js and PHP 7 for the full time. Plus, I have been experimenting lately with Go and I quite like it. Apart from these, if I have to choose another one, I would go for Ruby. However this is just my personal preference, you can choose any of the shown languages and you will be good.</p><p><img src="https://i.imgur.com/Ihg4YAb.png" alt=""></p><h2 id="👷-DevOps-Roadmap"><a href="#👷-DevOps-Roadmap" class="headerlink" title="👷 DevOps Roadmap"></a>👷 DevOps Roadmap</h2><p><img src="https://i.imgur.com/pyg9mH1.png" alt=""></p><h2 id="🚦-Wrap-Up"><a href="#🚦-Wrap-Up" class="headerlink" title="🚦 Wrap Up"></a>🚦 Wrap Up</h2><p>If you think any of the roadmaps can be improved, please do open a PR with any updates and submit any issues. Also, I will continue to improve this, so you might want to watch/star this repository to revisit.</p><h2 id="☑-TODO"><a href="#☑-TODO" class="headerlink" title="☑ TODO"></a>☑ TODO</h2><ul><li>[X] Add Frontend Roadmap</li><li>[X] Add Backend Roadmap</li><li>[X] Add DevOps Roadmap</li><li>[ ] Add relevant resources for each</li></ul><h2 id="👬-Contribution"><a href="#👬-Contribution" class="headerlink" title="👬 Contribution"></a>👬 Contribution</h2><p>The roadmaps are built using <a href="https://balsamiq.com/products/mockups/" target="_blank" rel="noopener">Balsamiq</a>. Project file can be found at <code>/project-files</code> directory. To modify any of the roadmaps, open Balsamiq, click <strong>Project &gt; Import &gt; Mockup JSON</strong>, it will open the roadmap for you, update it, upload and update the images in readme and create a PR.        </p><ul><li>Open pull request with improvements</li><li>Discuss ideas in issues</li><li>Spread the word</li><li>Reach out with any feedback</li></ul><h2 id="Sponsored-By"><a href="#Sponsored-By" class="headerlink" title="Sponsored By"></a>Sponsored By</h2><ul><li><a href="https://hackr.io" target="_blank" rel="noopener">Hackr.io - Find &amp; Share the Best Online Programming Courses &amp; Tutorials</a></li><li><a href="http://highig.com/" target="_blank" rel="noopener">Highig - Think and its done</a></li></ul><blockquote><p>搬运自<a href="https://github.com/kamranahmedse/developer-roadmap/blob/master/README.md" target="_blank" rel="noopener">kamranahmedse/developer-roadmap</a>，侵删</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://i.imgur.com/oxsayps.png&quot; alt=&quot;Web Developer Roadmap&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Roadmap to becoming a web developer in 2018&lt;/p&gt;
&lt;p&gt;There is a &lt;a href=&quot;https://www.youtube.com/watch?v=wdjvfPMZ7hg&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;recorded version of this on youtube now&lt;/a&gt;. Also, I just created this channel and &lt;a href=&quot;https://github.com/hugobots/we-want&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;have got some nice plans for the screencasts&lt;/a&gt; so make sure to &lt;a href=&quot;https://www.youtube.com/c/kamranahmed_se&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;subscribe to the channel&lt;/a&gt;, if you would like :)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Below you find a set of charts demonstrating the paths that you can take and the technologies that you would want to adopt in order to become a frontend, backend or a devops. I made these charts for an old professor of mine who wanted something to share with his college students to give them a perspective.&lt;/p&gt;
&lt;p&gt;If you think that these can be improved in anyway, please do suggest.&lt;/p&gt;
&lt;hr&gt;
&lt;p align=&quot;center&quot;&gt;&lt;b&gt; Did you like this guide and want more of the similar content? &lt;/b&gt;&lt;br&gt;Subscribe for the launch of &lt;a href=&quot;http://hugobots.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hugobots&lt;/a&gt; or &lt;a href=&quot;http://twitter.com/kamranahmedse&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;follow me on twitter&lt;/a&gt;!&lt;/p&gt;

&lt;hr&gt;
    
    </summary>
    
      <category term="前端杂谈" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="前端杂谈" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>浅析正则表达式</title>
    <link href="http://yoursite.com/2018/02/11/javascript-RegExp/"/>
    <id>http://yoursite.com/2018/02/11/javascript-RegExp/</id>
    <published>2018-02-11T07:12:06.000Z</published>
    <updated>2018-04-10T05:51:32.445Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h1><blockquote><p>正则表达式是用于匹配字符串中字符组合的模式。在 JavaScript中，正则表达式也是对象。这些模式被用于 <code>RegExp</code> 的 <code>exec</code> 和 <code>test</code> 方法, 以及 <code>String</code> 的 <code>match</code>、<code>replace</code>、<code>search</code> 和 <code>split</code> 方法。 - - <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener">MDN</a></p></blockquote><h1 id="术语与操作符"><a href="#术语与操作符" class="headerlink" title="术语与操作符"></a>术语与操作符</h1><h2 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h2><table><thead><tr><th style="text-align:left">字符</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">\</td><td style="text-align:left">匹配将依照下列规则：在非特殊字符之前的反斜杠表示下一个字符是特殊的；特殊字符前的反斜杠则转义其后的特殊字符为字面量。如：/\d/ 匹配一个数字，/a\*/ 匹配‘a*’</td></tr><tr><td style="text-align:left">^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="text-align:left">匹配输入的开始。如：/^a/匹配以a开始的字符</td></tr><tr><td style="text-align:left">$</td><td style="text-align:left">匹配输入的结束。如：/b$/匹配以b结束的字符</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">匹配前一个表达式0次或多次，等价于{0,}。如：/cd*/匹配‘abcdef’中的‘cd’，匹配‘abcef’中的‘c’，但不会匹配‘abdef’中的任何字符。</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">匹配前一个表达式1次或多次，等价于{1,}。如：/a+/匹配了在 ‘candy’ 中的 ‘a’，和在 ‘caaaaaaandy’ 中所有的 ‘a’。</td></tr><tr><td style="text-align:left">?</td><td style="text-align:left">匹配前一个表达式0次或1次，等价于 {0,1}。如：/e?le?/ 匹配 ‘angel’ 中的 ‘el’，和 ‘angle’ 中的 ‘le’ 以及‘oslo’ 中的‘l’。如果紧跟在任何量词 *、 +、? 或 {} 的后面，将会使量词变为非贪婪的（匹配尽量少的字符），如：/\d+?/ 匹配‘123abc’中的‘1’</td></tr><tr><td style="text-align:left">.</td><td style="text-align:left">匹配除换行符之外的任何单个字符。如：/.n/将会匹配 “nay, an apple is on the tree” 中的 ‘an’ 和 ‘on’，但是不会匹配 ‘nay’。</td></tr><tr><td style="text-align:left">(x)</td><td style="text-align:left">匹配 ‘x’ 并且记住匹配项。如：/(foo) (bar) \1 \2/将会匹配 “foo bar foo bar” 并记住前2个单词。</td></tr><tr><td style="text-align:left">(?:x)</td><td style="text-align:left">匹配 ‘x’ 但不记住匹配项。如：/(?:foo){1,2}/，如果表达式是 /foo{1,2}/，{1,2}将只对 ‘foo’ 的最后一个字符 ’o‘ 生效。如果使用非捕获括号，则{1,2}会匹配整个 ‘foo’ 单词。</td></tr><tr><td style="text-align:left">x(?=y)</td><td style="text-align:left">匹配 ‘x’ 仅仅当 ‘x’ 后面跟着 ‘y’。如：/Jack(?=Sprat)/会匹配到’Jack’仅仅当它后面跟着 ‘Sprat’。但是‘Sprat’不是匹配结果的一部分。</td></tr><tr><td style="text-align:left">x(?!y)</td><td style="text-align:left">匹配 ‘x’ 仅仅当 ‘x’ 后面不跟着 ‘y’。如：/\d+(?!.)/匹配一个数字仅仅当这个数字后面没有跟小数点的时候。正则表达式/\d+(?!.)/.exec(“3.141”)匹配‘141’但是不是‘3.141’。</td></tr><tr><td style="text-align:left">{n}</td><td style="text-align:left">匹配了前面一个字符刚好发生了n次。如：/a{2}/不会匹配“candy”中的 ‘a’,但是会匹配“caandy”中所有的a，以及“caaandy”中的前两个 ‘a’。</td></tr><tr><td style="text-align:left">{n,m}</td><td style="text-align:left">匹配匹配前面的字符至少n次，最多m次。如：/a{1, 3}/ 并不匹配“cndy”中的任意字符，匹配“candy”中得a，匹配“caandy”中的前两个a，也匹配“caaaaaaandy”中的前三个a。</td></tr><tr><td style="text-align:left">[xyz]</td><td style="text-align:left">匹配方括号的中任意字符，包括转义序列，可以使用破折号（-）来指定一个字符范围。如：[abcd] 和[a-d]是一样的。他们都匹配”brisket”中得‘b’,也都匹配“city”中的‘c’。/[a-z.]+/ 和/[\w.]+/都匹配“test.i.ng”中得所有字符。</td></tr><tr><td style="text-align:left">[^xyz]</td><td style="text-align:left">匹配任何没有包含在方括号中的字符。如：[^abc] 和 [^a-c] 是一样的。他们匹配”brisket”中得‘r’，也匹配“chop”中的‘h’。</td></tr><tr><td style="text-align:left">[\b]</td><td style="text-align:left">匹配一个退格(U+0008)。</td></tr></tbody></table><a id="more"></a><h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><table><thead><tr><th style="text-align:left">字符</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">\b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="text-align:left">匹配一个词的边界。如：/\bm/匹配“moon”中的‘m’；/oo\b/并不匹配 “moon”中的 ‘oo’，/oon\b/匹配 “moon”中的 ‘oon’</td></tr><tr><td style="text-align:left">\B</td><td style="text-align:left">匹配一个非单词边界，一个字符串的开始和结尾都被认为是非单词。如：/\B../匹配 “noonday” 中得 ‘oo’, 而/y\B./匹配 “possibly yesterday”中得 ‘ye’</td></tr><tr><td style="text-align:left">\cX</td><td style="text-align:left">当X是处于A到Z之间的字符的时候，匹配字符串中的一个控制符。如：/\cM/ 匹配字符串中的 control-M (U+000D)。</td></tr><tr><td style="text-align:left">\d</td><td style="text-align:left">匹配一个数字，等价于[0-9]。如：/\d/ 或者 /[0-9]/ 匹配 “B2 is the suite number.”中的 ‘2’。</td></tr><tr><td style="text-align:left">\D</td><td style="text-align:left">匹配一个非数字字符，等价于[^0-9]。如：/\D/ 或者 /[^0-9]/ 匹配 “B2 is the suite number.”中的 ‘B’。</td></tr><tr><td style="text-align:left">\f</td><td style="text-align:left">匹配一个换页符。</td></tr><tr><td style="text-align:left">\n</td><td style="text-align:left">匹配一个换行符。</td></tr><tr><td style="text-align:left">\r</td><td style="text-align:left">匹配一个回车符。</td></tr><tr><td style="text-align:left">\s</td><td style="text-align:left">匹配一个空白字符，包括空格、制表符、换页符和换行符。如：/\s\w*/ 匹配 “foo bar.”中的 ‘ bar’。</td></tr><tr><td style="text-align:left">\S</td><td style="text-align:left">匹配一个非空白字符。如：/\S\w*/ 匹配 “foo bar.”中的 ‘foo’。</td></tr><tr><td style="text-align:left">\w</td><td style="text-align:left">匹配一个单字字符。如：/\w/ 匹配 “apple,” 中的 ‘a’， “$5.28,” 中的 ‘5’ 和 “3D.” 中的 ‘3’。</td></tr><tr><td style="text-align:left">\W</td><td style="text-align:left">匹配一个非单字字符。如：/\W/ 或者 /[^A-Za-z0-9_]/ 匹配 “50%.” 中的 ‘%’。</td></tr><tr><td style="text-align:left">\n</td><td style="text-align:left">当 n 是一个正整数，一个返回引用到最后一个与有n插入的正则表达式(counting left parentheses)匹配的副字符串。如：/apple(,)\sorange\1/ 匹配 “apple, orange, cherry, peach.”中的 ‘apple, orange,’ 。</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概念介绍&quot;&gt;&lt;a href=&quot;#概念介绍&quot; class=&quot;headerlink&quot; title=&quot;概念介绍&quot;&gt;&lt;/a&gt;概念介绍&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;正则表达式是用于匹配字符串中字符组合的模式。在 JavaScript中，正则表达式也是对象。这些模式被用于 &lt;code&gt;RegExp&lt;/code&gt; 的 &lt;code&gt;exec&lt;/code&gt; 和 &lt;code&gt;test&lt;/code&gt; 方法, 以及 &lt;code&gt;String&lt;/code&gt; 的 &lt;code&gt;match&lt;/code&gt;、&lt;code&gt;replace&lt;/code&gt;、&lt;code&gt;search&lt;/code&gt; 和 &lt;code&gt;split&lt;/code&gt; 方法。 - - &lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MDN&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;术语与操作符&quot;&gt;&lt;a href=&quot;#术语与操作符&quot; class=&quot;headerlink&quot; title=&quot;术语与操作符&quot;&gt;&lt;/a&gt;术语与操作符&lt;/h1&gt;&lt;h2 id=&quot;特殊字符&quot;&gt;&lt;a href=&quot;#特殊字符&quot; class=&quot;headerlink&quot; title=&quot;特殊字符&quot;&gt;&lt;/a&gt;特殊字符&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;字符&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;\&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配将依照下列规则：在非特殊字符之前的反斜杠表示下一个字符是特殊的；特殊字符前的反斜杠则转义其后的特殊字符为字面量。如：/\d/ 匹配一个数字，/a\*/ 匹配‘a*’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;^&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配输入的开始。如：/^a/匹配以a开始的字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;$&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配输入的结束。如：/b$/匹配以b结束的字符&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;*&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配前一个表达式0次或多次，等价于{0,}。如：/cd*/匹配‘abcdef’中的‘cd’，匹配‘abcef’中的‘c’，但不会匹配‘abdef’中的任何字符。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;+&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配前一个表达式1次或多次，等价于{1,}。如：/a+/匹配了在 ‘candy’ 中的 ‘a’，和在 ‘caaaaaaandy’ 中所有的 ‘a’。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;?&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配前一个表达式0次或1次，等价于 {0,1}。如：/e?le?/ 匹配 ‘angel’ 中的 ‘el’，和 ‘angle’ 中的 ‘le’ 以及‘oslo’ 中的‘l’。如果紧跟在任何量词 *、 +、? 或 {} 的后面，将会使量词变为非贪婪的（匹配尽量少的字符），如：/\d+?/ 匹配‘123abc’中的‘1’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;.&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配除换行符之外的任何单个字符。如：/.n/将会匹配 “nay, an apple is on the tree” 中的 ‘an’ 和 ‘on’，但是不会匹配 ‘nay’。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;(x)&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配 ‘x’ 并且记住匹配项。如：/(foo) (bar) \1 \2/将会匹配 “foo bar foo bar” 并记住前2个单词。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;(?:x)&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配 ‘x’ 但不记住匹配项。如：/(?:foo){1,2}/，如果表达式是 /foo{1,2}/，{1,2}将只对 ‘foo’ 的最后一个字符 ’o‘ 生效。如果使用非捕获括号，则{1,2}会匹配整个 ‘foo’ 单词。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;x(?=y)&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配 ‘x’ 仅仅当 ‘x’ 后面跟着 ‘y’。如：/Jack(?=Sprat)/会匹配到’Jack’仅仅当它后面跟着 ‘Sprat’。但是‘Sprat’不是匹配结果的一部分。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;x(?!y)&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配 ‘x’ 仅仅当 ‘x’ 后面不跟着 ‘y’。如：/\d+(?!.)/匹配一个数字仅仅当这个数字后面没有跟小数点的时候。正则表达式/\d+(?!.)/.exec(“3.141”)匹配‘141’但是不是‘3.141’。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;{n}&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配了前面一个字符刚好发生了n次。如：/a{2}/不会匹配“candy”中的 ‘a’,但是会匹配“caandy”中所有的a，以及“caaandy”中的前两个 ‘a’。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;{n,m}&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配匹配前面的字符至少n次，最多m次。如：/a{1, 3}/ 并不匹配“cndy”中的任意字符，匹配“candy”中得a，匹配“caandy”中的前两个a，也匹配“caaaaaaandy”中的前三个a。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;[xyz]&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配方括号的中任意字符，包括转义序列，可以使用破折号（-）来指定一个字符范围。如：[abcd] 和[a-d]是一样的。他们都匹配”brisket”中得‘b’,也都匹配“city”中的‘c’。/[a-z.]+/ 和/[\w.]+/都匹配“test.i.ng”中得所有字符。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;[^xyz]&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配任何没有包含在方括号中的字符。如：[^abc] 和 [^a-c] 是一样的。他们匹配”brisket”中得‘r’，也匹配“chop”中的‘h’。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;[\b]&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;匹配一个退格(U+0008)。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://yoursite.com/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Node实现文件系统操作：导出Excel</title>
    <link href="http://yoursite.com/2018/02/08/Node-export-excel/"/>
    <id>http://yoursite.com/2018/02/08/Node-export-excel/</id>
    <published>2018-02-08T08:38:34.000Z</published>
    <updated>2018-04-10T05:50:14.237Z</updated>
    
    <content type="html"><![CDATA[<h1 id="依赖模块以及第三方包"><a href="#依赖模块以及第三方包" class="headerlink" title="依赖模块以及第三方包"></a>依赖模块以及第三方包</h1><p>node中，文件 I/O 是对标准 POSIX 函数的简单封装，通过<code>fs</code>模块可实现对文件系统的操作；因为要操作报表，这里我们引入三方包<code>node-xlsx</code></p><h1 id="API说明"><a href="#API说明" class="headerlink" title="API说明"></a>API说明</h1><p><code>fs</code>模块提供了<code>fs.writeFile(file, data[, options], callback)</code>和<code>fs.writeFileSync(file, data[, options])</code>两个api实现对文件的写入，由方法名可知分别是异步和同步的实现</p><p><strong>fs.writeFile(file, data[, options], callback)</strong></p><ul><li>file <code>&lt;string&gt;</code> | <code>&lt;Buffer&gt;</code> | <code>&lt;integer&gt;</code> 文件名或文件描述符</li><li>data <code>&lt;string&gt;</code> | <code>&lt;Buffer&gt;</code> | <code>&lt;Uint8Array&gt;</code></li><li>options <code>&lt;Object&gt;</code> | <code>&lt;string&gt;</code></li><li>callback <code>&lt;Function&gt;</code></li></ul><p>异步地写入数据到文件，如果文件已经存在，则替代文件。 data 可以是一个字符串或一个 buffer。任何指定的文件描述符必须支持写入,多次对同一文件使用 fs.writeFile 且不等待回调，是不安全的。 对于这种情况，强烈推荐使用 fs.createWriteStream。fs.writeFileSync()为fs.writeFile() 的同步版本，返回 undefined。<br><a id="more"></a></p><h1 id="需求实现"><a href="#需求实现" class="headerlink" title="需求实现"></a>需求实现</h1><p>简单了解了API之后，我们就可以实现写入文件数据的功能了，但要生成Excel文件，还需借助三方包<code>node-xlsx</code>。至于该三方包的详细API，请移步官方<a href="https://www.npmjs.com/package/node-xlsx" target="_blank" rel="noopener">xlsx</a>查看，下面看代码示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AdvertisedPrice = <span class="built_in">require</span>(<span class="string">'./api/consultant-system/config/advertised-price'</span>);</span><br><span class="line"><span class="keyword">const</span> xlsx = <span class="built_in">require</span>(<span class="string">'node-xlsx'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//表格需要导出的内容</span></span><br><span class="line"><span class="keyword">const</span> excelHeaders = &#123;</span><br><span class="line">    detailHeader: [</span><br><span class="line">        <span class="string">'类目id'</span>, <span class="string">'类目名称'</span>, <span class="string">'类目价格'</span></span><br><span class="line">    ],</span><br><span class="line">    detailHeaderAlias: [</span><br><span class="line">        <span class="string">'key'</span>, <span class="string">'keyName'</span>, <span class="string">'value'</span></span><br><span class="line">    ],</span><br><span class="line">    detailHeaderWidth: &#123;</span><br><span class="line">        <span class="string">'!cols'</span>: [</span><br><span class="line">            &#123;<span class="attr">wch</span>: <span class="number">15</span>&#125;, &#123;<span class="attr">wch</span>: <span class="number">55</span>&#125;, &#123;<span class="attr">wch</span>: <span class="number">15</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 数据转换</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformData</span>(<span class="params">arr, excelHeader, excelHeaderAlias, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(arr)) &#123;</span><br><span class="line">        res.send(<span class="string">'数据格式不对'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> finalArr = []</span><br><span class="line">    <span class="keyword">const</span> hAlias = excelHeaders[excelHeaderAlias]</span><br><span class="line">    arr.forEach(<span class="function">(<span class="params">curVal, index</span>) =&gt;</span> &#123;</span><br><span class="line">        finalArr[index] = []</span><br><span class="line">        hAlias.forEach(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (val === <span class="string">'key'</span>) &#123;</span><br><span class="line">                finalArr[index].push((curVal)[val].split(<span class="string">'.'</span>)[<span class="number">3</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                finalArr[index].push((curVal)[val])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    finalArr.unshift(excelHeaders[excelHeader])</span><br><span class="line">    <span class="keyword">return</span> finalArr</span><br><span class="line">&#125;</span><br><span class="line">UA.onGet(<span class="string">'/api/consultant/config/advertised-price/export'</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> qo = req.query</span><br><span class="line">    <span class="keyword">let</span> queryData = &#123;</span><br><span class="line">        groupName: qo.groupName,</span><br><span class="line">        originData: qo.originData || []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> AdvertisedPrice(queryData).getAllAdvertisedPrice().then(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> tempData = rs.data</span><br><span class="line">        <span class="keyword">if</span> (tempData) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = transformData(tempData, qo.header, qo.headerAlias, res)</span><br><span class="line">            <span class="keyword">const</span> buffer = xlsx.build([&#123;<span class="attr">data</span>: data, <span class="attr">name</span>: qo.filename&#125;], excelHeaders[<span class="string">`<span class="subst">$&#123;qo.header&#125;</span>Width`</span>])</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.writeFileSync(<span class="string">`<span class="subst">$&#123;qo.filename&#125;</span>.xlsx`</span>, buffer, <span class="string">'binary'</span>)</span><br><span class="line">                res.download(<span class="string">`<span class="subst">$&#123;qo.filename&#125;</span>.xlsx`</span>, err =&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        res.send(<span class="string">`download price excel failed---&gt;<span class="subst">$&#123;err.toString()&#125;</span>`</span>)</span><br><span class="line">                        next()</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        res.send(<span class="string">'download price excel successful'</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`download price excel failed---&gt;<span class="subst">$&#123;error.toString()&#125;</span>`</span>)</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                fs.unlink(<span class="string">`<span class="subst">$&#123;qo.filename&#125;</span>.xlsx`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(&#123;<span class="attr">msg</span>: <span class="string">'download price excel failed: has no price config data'</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        res.send(&#123;<span class="attr">msg</span>: <span class="string">`download price excel failed---&gt;<span class="subst">$&#123;err&#125;</span>`</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="前端层请求"><a href="#前端层请求" class="headerlink" title="前端层请求"></a>前端层请求</h1><p>需要注意的是：因为文件是以流的形式传输，而ajax请求的返回值类型是json、text、HTML、xml等类型，所以ajax是无法实现文件下载的。但用ajax仍然可以获得文件的内容，该文件将被保留在内存中，无法将文件保存到磁盘。这是因为JavaScript无法和磁盘进行交互，否则这会是一个严重的安全问题，js无法调用到浏览器的下载处理机制和程序，会被浏览器阻塞。实现文件下载可以用<code>&lt;a&gt;</code>标签或者<code>location.href</code>实现</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;依赖模块以及第三方包&quot;&gt;&lt;a href=&quot;#依赖模块以及第三方包&quot; class=&quot;headerlink&quot; title=&quot;依赖模块以及第三方包&quot;&gt;&lt;/a&gt;依赖模块以及第三方包&lt;/h1&gt;&lt;p&gt;node中，文件 I/O 是对标准 POSIX 函数的简单封装，通过&lt;code&gt;fs&lt;/code&gt;模块可实现对文件系统的操作；因为要操作报表，这里我们引入三方包&lt;code&gt;node-xlsx&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;API说明&quot;&gt;&lt;a href=&quot;#API说明&quot; class=&quot;headerlink&quot; title=&quot;API说明&quot;&gt;&lt;/a&gt;API说明&lt;/h1&gt;&lt;p&gt;&lt;code&gt;fs&lt;/code&gt;模块提供了&lt;code&gt;fs.writeFile(file, data[, options], callback)&lt;/code&gt;和&lt;code&gt;fs.writeFileSync(file, data[, options])&lt;/code&gt;两个api实现对文件的写入，由方法名可知分别是异步和同步的实现&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;fs.writeFile(file, data[, options], callback)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;file &lt;code&gt;&amp;lt;string&amp;gt;&lt;/code&gt; | &lt;code&gt;&amp;lt;Buffer&amp;gt;&lt;/code&gt; | &lt;code&gt;&amp;lt;integer&amp;gt;&lt;/code&gt; 文件名或文件描述符&lt;/li&gt;
&lt;li&gt;data &lt;code&gt;&amp;lt;string&amp;gt;&lt;/code&gt; | &lt;code&gt;&amp;lt;Buffer&amp;gt;&lt;/code&gt; | &lt;code&gt;&amp;lt;Uint8Array&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;options &lt;code&gt;&amp;lt;Object&amp;gt;&lt;/code&gt; | &lt;code&gt;&amp;lt;string&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;callback &lt;code&gt;&amp;lt;Function&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;异步地写入数据到文件，如果文件已经存在，则替代文件。 data 可以是一个字符串或一个 buffer。任何指定的文件描述符必须支持写入,多次对同一文件使用 fs.writeFile 且不等待回调，是不安全的。 对于这种情况，强烈推荐使用 fs.createWriteStream。fs.writeFileSync()为fs.writeFile() 的同步版本，返回 undefined。&lt;br&gt;
    
    </summary>
    
      <category term="Node" scheme="http://yoursite.com/categories/Node/"/>
    
    
      <category term="Node" scheme="http://yoursite.com/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>Linux学习笔记一：文件权限与目录配置</title>
    <link href="http://yoursite.com/2018/01/17/Linux-file-directory-config/"/>
    <id>http://yoursite.com/2018/01/17/Linux-file-directory-config/</id>
    <published>2018-01-17T13:37:47.000Z</published>
    <updated>2018-04-10T06:25:20.239Z</updated>
    
    <content type="html"><![CDATA[<h1 id="文件属性"><a href="#文件属性" class="headerlink" title="文件属性"></a>文件属性</h1><p>u start –&gt; permission deny ？老铁，肯定是权限不够 ！虽然你<code>sudo u start</code>了，但我还是想从Linux的文件属性下嘴，和大家一起学习学习Linux的文件权限。话不多说，首先我们执行一下<code>ls -l</code>（先别问为什么，我也不知道），看到以下结果：<br><img src="/images/2018-01-17-Linux-file-directory-config/LinuxFiles.png" alt="Linux文件属性">  </p><blockquote><p><code>ls</code>是list的意思，该命令显示文件的文件名与相关属性，参数<code>-l</code>表示以单列格式输出文件的相关信息。 </p></blockquote><a id="more"></a> <p><strong>第一列：代表该文件的类型与权限</strong><br>可以看到，第一列一共有10个字符，其中第一个字符代表该文件的类型  </p><ul><li>[d]：目录</li><li>[-]：文件</li><li>[l]：连接文件（linkfile，类似于Windows下的快捷方式）</li><li>[b]：设备文件里面的可供存储的接口设备</li><li>[c]：设备文件里面的串行端口设备，例如键盘、鼠标等  </li></ul><p>接下来的字符中，以3个为一组，且均为”rwx的3个参数的组合。<code>r</code>代表可读(read)，<code>w</code>代表可写(write)，<code>x</code>代表可执行(execute)，这3个权限的位置不会改变，如果没有权限，则显示为<code>“-”</code>：</p><ul><li>第一组：[文件拥有者可具备的权限]，以“Tomorrow.itermcolors”为例，该文件所有者可以读写，但不可执行</li><li>第二组：[加入该用户组的账号对此文件的权限]</li><li>第三组：[其他非本用户组且非拥有者的账号对此文件的权限]</li></ul><p><strong>第二列：表示有多少文件名连接到该节点（i-node）</strong><br><strong>第三列：代表该文件（目录）的“所有者账号”</strong>  </p><p><strong>第四列：代表该文件的所属用户组</strong><br>Linux系统下，用户账号会附属于一个或者多个用户组中。比如用户User1、User2、USer3均属于staff这个用户组，如上图所示“Creative Cloud Files”所属的用户组为staff，该文件的权限为<code>drwxrwxr-x</code>,则用户USer1、USer2、USer3对该文件都具有可读、可写、可执行的权限，但非staff用户组的其他用户对该文件只具备可读、可执行的权限</p><p><strong>第五列：代表该文件的容量大小，默认单位为B</strong><br><strong>第六列：代表该文件的创建日期或最近修改日期</strong><br><strong>第七列：代表该文件的名称</strong>  </p><h1 id="修改文件属性与权限"><a href="#修改文件属性与权限" class="headerlink" title="修改文件属性与权限"></a>修改文件属性与权限</h1><p>现在我们已经大概了解到了文件的属性与权限，那么如何修改一个文件的属性与权限呢？其实一个文件的属性与权限有很多，我们先了解几个常用于用户组、所有者、其他各种权限的修改命令：</p><ul><li>chgrp：改变文件所属用户组</li><li>chown：改变文件所有者</li><li>chmod：改变文件权限</li></ul><h2 id="改变所属用户组：chgrp（change-group）"><a href="#改变所属用户组：chgrp（change-group）" class="headerlink" title="改变所属用户组：chgrp（change group）"></a>改变所属用户组：chgrp（change group）</h2><ul><li>要被改变的组名必须要在<code>/etc/group</code>文件内 存在才行，否则会执行失败</li><li>命令格式为：chgrp [-R] dirname/filename（<code>-R</code>表示进行递归的持续更改，即连同子目录下的所有文件都更新为这个用户组）</li></ul><p><img src="/images/2018-01-17-Linux-file-directory-config/chgrp-1.png" alt="改变所属用户组"><br><img src="/images/2018-01-17-Linux-file-directory-config/chgrp-2.png" alt="改变所属用户组"></p><h2 id="改变文件所有者：chown（change-owner）"><a href="#改变文件所有者：chown（change-owner）" class="headerlink" title="改变文件所有者：chown（change owner）"></a>改变文件所有者：chown（change owner）</h2><ul><li>用户必须是已经存在于系统中的账号（/etc/passwd这个文件中有记录的用户）</li><li>chown [-R] 账号名称 文件或目录</li><li>chown [-R] 账号名称:组名 文件或目录</li></ul><p><img src="/images/2018-01-17-Linux-file-directory-config/chown-1.png" alt="改变文件拥有者"></p><h2 id="改变文件权限：chmod（change-mode）"><a href="#改变文件权限：chmod（change-mode）" class="headerlink" title="改变文件权限：chmod（change mode）"></a>改变文件权限：chmod（change mode）</h2><p>文件权限的改变使用的是chmod指令，设定方法有两种：数字和符号</p><p><strong>1、数字类型改变文件权限</strong><br>Linux文件的基本权限有9个，分别是owner/group/others三种身份各有自己的read/write/execute权限，如之前看到的文件权限：<code>[-rwxr-xr--]</code>，这9个权限是3个3个一组。我们可以用数字来代表各个权限</p><ul><li>r:4</li><li>w:2</li><li>x:1</li></ul><p>每种身份各自的3个权限累加，上面的例子中：</p><ul><li>owner  = rwx = 4+2+1 = 7</li><li>group  = r-x = 4+0+1 = 5</li><li>others = r– = 4+0+0 = 4</li></ul><p>所以，如果要将上述例子中权限为<code>[-rwxr-xr--]</code>的权限改为<code>[-rwxrwxrwx]</code>，那么对应的权限分数就是<code>[4+2+1][4+2+1][4+2+1]=777</code>，下面我们一起来看下chmod指令的实际应用吧<br><img src="/images/2018-01-17-Linux-file-directory-config/chmod-1.png" alt="数字类型改变文件权限"></p><p><strong>2、符号类型改变文件权限</strong><br>上面有讲到，文件的权限有9个，分别是user(3个：rwx)、group(3个：rwx)、others(3个：rwx)，由u、g、o分别代表3中身份<br><img src="/images/2018-01-17-Linux-file-directory-config/chmod-2.png" alt="符号类型改变文件权限"></p><p>来实际操作一下吧！假如我们要<code>设定</code>一个文件的权限为<code>drwxr--r--</code>，则<code>u=rwx,go=r</code><br><img src="/images/2018-01-17-Linux-file-directory-config/chmod-3.png" alt="符号类型改变文件权限"></p><blockquote><p>需要特别注意的是：<code>u=rwx,go=r</code>是连在一起的，中间没有任何空格符！</p></blockquote><h1 id="Linux目录配置"><a href="#Linux目录配置" class="headerlink" title="Linux目录配置"></a>Linux目录配置</h1><h2 id="Linux目录配置标准–FHS"><a href="#Linux目录配置标准–FHS" class="headerlink" title="Linux目录配置标准–FHS"></a>Linux目录配置标准–FHS</h2><p>目前大多数Linux系统都遵循FHS规范，FHS依据“文件系统使用的频率以及是否允许文件系统使用者随意更改”而将目录定义成四种交互作用的形态，大概像下面这样：<br><img src="/images/2018-01-17-Linux-file-directory-config/directory-1.png" alt="Linux目录配置"><br>上表中的目录是一些代表性的目录，这些目录代表的四个类型的意义如下：</p><ul><li>可分享的：可以分享给其他系统挂载使用（例如执行文件、用户的邮件数据等）</li><li>不可分享的：个人机器上运行的装置文件或者与程序相关的socket文件（仅与自身机器有关）</li><li>不变的：不会经常变动的数据（例如函式库、文件说明文件、主机服务配置文件等）</li><li>可变动的：经常改变的数据（例如登录文件、一般用户可自行收受的新闻组等）  </li></ul><p>事实上，FHS针对目录树结构仅定义出三层目录底下应该放置什么数据，分别是：</p><ul><li>/(root，根目录)：与开机系统有关</li><li>/usr(unix software resource)：与软件安装/执行有关</li><li>/var(variable)：与系统运作过程有关</li></ul><h2 id="目录树（directory-tree）"><a href="#目录树（directory-tree）" class="headerlink" title="目录树（directory tree）"></a>目录树（directory tree）</h2><p>因为所有文件和目录都是由根目录开始，再一个一个分支下来，有点像树枝状，因此将这种目录配置方式称为“目录树”。它的主要特征有：</p><ul><li>目录树的起点为根目录（/， root）</li><li>每一个目录不止能使用本地段的文件系统，也可以使用网络上的文件系统。例如可以利用<code>Network File System（NFS）</code>服务器挂载特定目录</li><li>每一个文件在此目录树种的文件名（包含完整路径）都是独一无二的</li></ul><p>如果将整个目录树以图示的方法来显示，并将较为重要的文件数据列出来的话，目录树架构图大概如图所示：<br><img src="/images/2018-01-17-Linux-file-directory-config/directoryTree-1.png" alt="Linux目录树"></p><h2 id="绝对路径与相对路径"><a href="#绝对路径与相对路径" class="headerlink" title="绝对路径与相对路径"></a>绝对路径与相对路径</h2><p>根据文件名写法的不同，可以将路径（path）定义为相对路径（relative）与绝对路径（absolute），这两种文件名/路径的写法依据如下：</p><ul><li>绝对路径：由根目录（/）开始写起，如 <code>/etc/hosts</code></li><li>相对路径：相对于目前路径的文件名写法。只要不是<code>/</code>开头的写法都属于相对路径写法，如<code>../Guest/</code>  </li></ul><p>思考：如果你当前在<code>/home</code>目录下，想进入<code>/var/log</code>目录，指令可以怎么写呢？如上述，绝对路径以根目录开始，相对路径是以“当前所在路径的相对位置”来表示的，那么可以这样写：</p><ul><li>cd ../var/log</li><li>cd /var/log</li></ul><p><code>./</code>代表当前目录，<code>../</code>代表上一层目录，使用<code>pwd</code>指令可以查看当前路径的绝对路径</p><h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>至此，相信大家对Linux的文件属性与目录结构已经有了初步的认识。感谢大家对本文的阅读，下一次，我将与大家一起学习Linux文件与目录管理的相关知识，敬请捧场。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;文件属性&quot;&gt;&lt;a href=&quot;#文件属性&quot; class=&quot;headerlink&quot; title=&quot;文件属性&quot;&gt;&lt;/a&gt;文件属性&lt;/h1&gt;&lt;p&gt;u start –&amp;gt; permission deny ？老铁，肯定是权限不够 ！虽然你&lt;code&gt;sudo u start&lt;/code&gt;了，但我还是想从Linux的文件属性下嘴，和大家一起学习学习Linux的文件权限。话不多说，首先我们执行一下&lt;code&gt;ls -l&lt;/code&gt;（先别问为什么，我也不知道），看到以下结果：&lt;br&gt;&lt;img src=&quot;/images/2018-01-17-Linux-file-directory-config/LinuxFiles.png&quot; alt=&quot;Linux文件属性&quot;&gt;  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;ls&lt;/code&gt;是list的意思，该命令显示文件的文件名与相关属性，参数&lt;code&gt;-l&lt;/code&gt;表示以单列格式输出文件的相关信息。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>CSS+图片简单实现五角星推荐指数</title>
    <link href="http://yoursite.com/2018/01/10/css-pentagram/"/>
    <id>http://yoursite.com/2018/01/10/css-pentagram/</id>
    <published>2018-01-10T12:26:38.000Z</published>
    <updated>2018-04-10T06:22:32.408Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>一张灰色五角星背景图至于底层，一张评分的亮色五角星图至于上层，利用CSS <code>clip</code>属性裁剪亮色五角星长度，实现推荐指数</p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"recommended"</span>&gt;</span></span><br><span class="line">    推荐指数</span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"stars"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"inner"</span> <span class="attr">:style</span>=<span class="string">"&#123;clip: rect&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123;baseInfo.recommended&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.stars</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">vertical-align</span>: top;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">13px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"../img/stars.png"</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">    .inner &#123;</span><br><span class="line">        <span class="selector-tag">display</span>: <span class="selector-tag">inline-block</span>;</span><br><span class="line">        <span class="selector-tag">vertical-align</span>: <span class="selector-tag">top</span>;</span><br><span class="line">        <span class="selector-tag">width</span>: 80<span class="selector-tag">px</span>;</span><br><span class="line">        <span class="selector-tag">height</span>: 13<span class="selector-tag">px</span>;</span><br><span class="line">        <span class="selector-tag">line-height</span>: 13<span class="selector-tag">px</span>;</span><br><span class="line">        background-image: url("../img/stars-active.png");</span><br><span class="line">        <span class="selector-tag">background-size</span>: <span class="selector-tag">contain</span>;</span><br><span class="line">        <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line">        <span class="comment">/*clip: rect(0 73px 13px 0);*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.rect = <span class="string">'rect(0,'</span> + (self.baseInfo.recommended / <span class="number">5</span>) * <span class="number">80</span> + <span class="string">'px, 13px, 0)'</span></span><br></pre></td></tr></table></figure><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="/images/2018-01-10-css-pentagram/recommended.png" alt="五星推荐指数"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;实现原理&quot;&gt;&lt;a href=&quot;#实现原理&quot; class=&quot;headerlink&quot; title=&quot;实现原理&quot;&gt;&lt;/a&gt;实现原理&lt;/h2&gt;&lt;p&gt;一张灰色五角星背景图至于底层，一张评分的亮色五角星图至于上层，利用CSS &lt;code&gt;clip&lt;/code&gt;属性裁剪亮色五角星长度，实现推荐指数&lt;/p&gt;
&lt;h2 id=&quot;HTML&quot;&gt;&lt;a href=&quot;#HTML&quot; class=&quot;headerlink&quot; title=&quot;HTML&quot;&gt;&lt;/a&gt;HTML&lt;/h2&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;recommended&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    推荐指数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;stars&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;inner&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;:style&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&amp;#123;clip: rect&amp;#125;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt;&amp;#123;&amp;#123;baseInfo.recommended&amp;#125;&amp;#125;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;i&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;span&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;CSS&quot;&gt;&lt;a href=&quot;#CSS&quot; class=&quot;headerlink&quot; title=&quot;CSS&quot;&gt;&lt;/a&gt;CSS&lt;/h2&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;selector-class&quot;&gt;.stars&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;display&lt;/span&gt;: inline-block;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;vertical-align&lt;/span&gt;: top;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;margin-top&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;2px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;margin-left&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;5px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;width&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;80px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;height&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;13px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;line-height&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;13px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;background-image&lt;/span&gt;: &lt;span class=&quot;built_in&quot;&gt;url&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;../img/stars.png&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attribute&quot;&gt;background-size&lt;/span&gt;: contain;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .inner &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;display&lt;/span&gt;: &lt;span class=&quot;selector-tag&quot;&gt;inline-block&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;vertical-align&lt;/span&gt;: &lt;span class=&quot;selector-tag&quot;&gt;top&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;width&lt;/span&gt;: 80&lt;span class=&quot;selector-tag&quot;&gt;px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;height&lt;/span&gt;: 13&lt;span class=&quot;selector-tag&quot;&gt;px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;line-height&lt;/span&gt;: 13&lt;span class=&quot;selector-tag&quot;&gt;px&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        background-image: url(&quot;../img/stars-active.png&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;background-size&lt;/span&gt;: &lt;span class=&quot;selector-tag&quot;&gt;contain&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;selector-tag&quot;&gt;position&lt;/span&gt;: &lt;span class=&quot;selector-tag&quot;&gt;absolute&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;/*clip: rect(0 73px 13px 0);*/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="CSS" scheme="http://yoursite.com/categories/CSS/"/>
    
    
      <category term="CSS" scheme="http://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>基于NodeJs防御csrf攻击</title>
    <link href="http://yoursite.com/2018/01/04/NodeJs-csrf/"/>
    <id>http://yoursite.com/2018/01/04/NodeJs-csrf/</id>
    <published>2018-01-04T13:32:40.000Z</published>
    <updated>2018-04-10T05:46:34.609Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CSRF简述"><a href="#CSRF简述" class="headerlink" title="CSRF简述"></a>CSRF简述</h2><p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。  </p><p>CSRF是一种夹持用户在已经登陆的web应用程序上执行非本意的操作的攻击方式。相比于XSS，CSRF是利用了系统对页面浏览器的信任，XSS则利用了系统对用户的信任。</p><h2 id="CSRF攻击原理及过程"><a href="#CSRF攻击原理及过程" class="headerlink" title="CSRF攻击原理及过程"></a>CSRF攻击原理及过程</h2><ul><li>User(C)通过浏览器访问并请求登录受信任站点A；</li><li>站点A通过验证并生成cookie返给浏览器</li><li>User(c)在没有退出站点A的情况下访问危险站点B</li><li>站点B接到请求后返回攻击代码，并发出一个请求要求访问第三方站点A</li><li>浏览器在接收到这些攻击性代码后，根据站点B的请求，在用户不知情的情况下携带Cookie信息，向站点A发出请求。站点A并不知道该请求其实是由B发起的，所以会根据User(C)的Cookie信息以C的权限处理该请求，导致来自站点B的恶意代码被执行</li></ul><h2 id="NodeJs下防御CSRF攻击思路"><a href="#NodeJs下防御CSRF攻击思路" class="headerlink" title="NodeJs下防御CSRF攻击思路"></a>NodeJs下防御CSRF攻击思路</h2><h3 id="验证-HTTP-Referer-字段"><a href="#验证-HTTP-Referer-字段" class="headerlink" title="验证 HTTP Referer 字段"></a>验证 HTTP Referer 字段</h3><p> HTTP 头中有一个 Referer 字段，它记录了该 HTTP 请求的来源地址，对该地址进行判断，如果同源则通过验证，否则拒绝请求<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">refererCheck(req, res, next)&#123;</span><br><span class="line">    <span class="keyword">let</span> referer = req.headers.referer;</span><br><span class="line">    <span class="keyword">let</span> refererHost = (referer &amp;&amp; referer.replace(<span class="regexp">/https?:\/\//ig</span>, <span class="string">""</span>).split(<span class="string">"/"</span>)[<span class="number">0</span>]) || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"\\."</span> + app.config.baseURI.replace(<span class="regexp">/\./g</span>, <span class="string">"\\."</span>) + <span class="string">"$"</span>;</span><br><span class="line">    <span class="keyword">if</span>(!reg.test(refererHost))&#123;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">app.get(<span class="string">'/api/test'</span>, utils.refererCheck, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// dosomething</span></span><br><span class="line">    <span class="keyword">return</span> xxx;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>以上，当请求<code>/api/test</code>时，站点A会劫持User(c)的请求并判断请求referer来源，如果发现来源于站点，则会拒绝请求<br><a id="more"></a></p><h3 id="添加-token-并验证"><a href="#添加-token-并验证" class="headerlink" title="添加 token 并验证"></a>添加 token 并验证</h3><p>在服务器上生成一个token, web端发起的请求都带上token这个参数, 请求中的token与服务端的token不一致,则抛出错误.<br>1、引入npm包csurf<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> csrf = <span class="built_in">require</span>(<span class="string">'csurf'</span>);</span><br><span class="line"><span class="keyword">const</span> csrfProtection = csrf(&#123;<span class="attr">cookie</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure></p><p>2、校验请求<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/form'</span>, csrfProtection, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// pass the csrfToken to the view </span></span><br><span class="line">    res.render(<span class="string">'send'</span>, &#123; <span class="attr">csrfToken</span>: req.csrfToken() &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="关于csurf模块"><a href="#关于csurf模块" class="headerlink" title="关于csurf模块"></a>关于csurf模块</h2><p>首先看下源码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">csurf</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> opts = options || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get cookie options</span></span><br><span class="line">    <span class="keyword">var</span> cookie = getCookieOptions(opts.cookie)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get session options</span></span><br><span class="line">    <span class="keyword">var</span> sessionKey = opts.sessionKey || <span class="string">'session'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// get value getter</span></span><br><span class="line">    <span class="keyword">var</span> value = opts.value || defaultValue</span><br><span class="line"></span><br><span class="line">    <span class="comment">// token repo</span></span><br><span class="line">    <span class="keyword">var</span> tokens = <span class="keyword">new</span> Tokens(opts)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ignored methods</span></span><br><span class="line">    <span class="keyword">var</span> ignoreMethods = opts.ignoreMethods === <span class="literal">undefined</span></span><br><span class="line">        ? [<span class="string">'GET'</span>, <span class="string">'HEAD'</span>, <span class="string">'OPTIONS'</span>]</span><br><span class="line">        : opts.ignoreMethods</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(ignoreMethods)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'option ignoreMethods must be an array'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// generate lookup</span></span><br><span class="line">    <span class="keyword">var</span> ignoreMethod = getIgnoredMethods(ignoreMethods)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">csrf</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// validate the configuration against request</span></span><br><span class="line">        <span class="keyword">if</span> (!verifyConfiguration(req, sessionKey, cookie)) &#123;</span><br><span class="line">            <span class="keyword">return</span> next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'misconfigured csrf'</span>))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get the secret from the request</span></span><br><span class="line">        <span class="keyword">var</span> secret = getSecret(req, sessionKey, cookie)</span><br><span class="line">        <span class="keyword">var</span> token</span><br><span class="line"></span><br><span class="line">        <span class="comment">// lazy-load token getter</span></span><br><span class="line">        req.csrfToken = <span class="function"><span class="keyword">function</span> <span class="title">csrfToken</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> sec = !cookie</span><br><span class="line">                ? getSecret(req, sessionKey, cookie)</span><br><span class="line">                : secret</span><br><span class="line"></span><br><span class="line">            <span class="comment">// use cached token if secret has not changed</span></span><br><span class="line">            <span class="keyword">if</span> (token &amp;&amp; sec === secret) &#123;</span><br><span class="line">                <span class="keyword">return</span> token</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// generate &amp; set new secret</span></span><br><span class="line">            <span class="keyword">if</span> (sec === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                sec = tokens.secretSync()</span><br><span class="line">                setSecret(req, res, sessionKey, sec, cookie)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// update changed secret</span></span><br><span class="line">            secret = sec</span><br><span class="line"></span><br><span class="line">            <span class="comment">// create new token</span></span><br><span class="line">            token = tokens.create(secret)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> token</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// generate &amp; set secret</span></span><br><span class="line">        <span class="keyword">if</span> (!secret) &#123;</span><br><span class="line">            secret = tokens.secretSync()</span><br><span class="line">            setSecret(req, res, sessionKey, secret, cookie)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// verify the incoming token</span></span><br><span class="line">        <span class="keyword">if</span> (!ignoreMethod[req.method] &amp;&amp; !tokens.verify(secret, value(req))) &#123;</span><br><span class="line">            <span class="keyword">return</span> next(createError(<span class="number">403</span>, <span class="string">'invalid csrf token'</span>, &#123;</span><br><span class="line">                code: <span class="string">'EBADCSRFTOKEN'</span></span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="服务端如何生产成token-token存储的位置"><a href="#服务端如何生产成token-token存储的位置" class="headerlink" title="服务端如何生产成token, token存储的位置"></a>服务端如何生产成token, token存储的位置</h3><p>当csurf()方法被执行时，会为req添加一个方法csrfToken，该方法生成一个token, 并保存session中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generate &amp; set secret</span></span><br><span class="line"><span class="keyword">if</span> (!secret) &#123;</span><br><span class="line">    secret = tokens.secretSync()</span><br><span class="line">    setSecret(req, res, sessionKey, secret, cookie)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="服务端校验的token-可能来自哪里"><a href="#服务端校验的token-可能来自哪里" class="headerlink" title="服务端校验的token, 可能来自哪里"></a>服务端校验的token, 可能来自哪里</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defaultValue</span> (<span class="params">req</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (req.body &amp;&amp; req.body._csrf) ||</span><br><span class="line">        (req.query &amp;&amp; req.query._csrf) ||</span><br><span class="line">        (req.headers[<span class="string">'csrf-token'</span>]) ||</span><br><span class="line">        (req.headers[<span class="string">'xsrf-token'</span>]) ||</span><br><span class="line">        (req.headers[<span class="string">'x-csrf-token'</span>]) ||</span><br><span class="line">        (req.headers[<span class="string">'x-xsrf-token'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从代码上，如果csurlf初始化时没带任何参数，则校验的token使用使用默认的值，默认的token可能来自req.body, req.query, req.header</p><h3 id="哪些请求不校验token"><a href="#哪些请求不校验token" class="headerlink" title="哪些请求不校验token"></a>哪些请求不校验token</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignored methods</span></span><br><span class="line"><span class="keyword">var</span> ignoreMethods = opts.ignoreMethods === <span class="literal">undefined</span></span><br><span class="line">    ? [<span class="string">'GET'</span>, <span class="string">'HEAD'</span>, <span class="string">'OPTIONS'</span>]</span><br><span class="line">    : opts.ignoreMethods</span><br></pre></td></tr></table></figure><p>如果csurlf初始化时没带任何参数，则 get head option方法不做校验</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1、<a href="https://www.npmjs.com/package/csurf" target="_blank" rel="noopener">npm csurf</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;CSRF简述&quot;&gt;&lt;a href=&quot;#CSRF简述&quot; class=&quot;headerlink&quot; title=&quot;CSRF简述&quot;&gt;&lt;/a&gt;CSRF简述&lt;/h2&gt;&lt;p&gt;CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。  &lt;/p&gt;
&lt;p&gt;CSRF是一种夹持用户在已经登陆的web应用程序上执行非本意的操作的攻击方式。相比于XSS，CSRF是利用了系统对页面浏览器的信任，XSS则利用了系统对用户的信任。&lt;/p&gt;
&lt;h2 id=&quot;CSRF攻击原理及过程&quot;&gt;&lt;a href=&quot;#CSRF攻击原理及过程&quot; class=&quot;headerlink&quot; title=&quot;CSRF攻击原理及过程&quot;&gt;&lt;/a&gt;CSRF攻击原理及过程&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;User(C)通过浏览器访问并请求登录受信任站点A；&lt;/li&gt;
&lt;li&gt;站点A通过验证并生成cookie返给浏览器&lt;/li&gt;
&lt;li&gt;User(c)在没有退出站点A的情况下访问危险站点B&lt;/li&gt;
&lt;li&gt;站点B接到请求后返回攻击代码，并发出一个请求要求访问第三方站点A&lt;/li&gt;
&lt;li&gt;浏览器在接收到这些攻击性代码后，根据站点B的请求，在用户不知情的情况下携带Cookie信息，向站点A发出请求。站点A并不知道该请求其实是由B发起的，所以会根据User(C)的Cookie信息以C的权限处理该请求，导致来自站点B的恶意代码被执行&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;NodeJs下防御CSRF攻击思路&quot;&gt;&lt;a href=&quot;#NodeJs下防御CSRF攻击思路&quot; class=&quot;headerlink&quot; title=&quot;NodeJs下防御CSRF攻击思路&quot;&gt;&lt;/a&gt;NodeJs下防御CSRF攻击思路&lt;/h2&gt;&lt;h3 id=&quot;验证-HTTP-Referer-字段&quot;&gt;&lt;a href=&quot;#验证-HTTP-Referer-字段&quot; class=&quot;headerlink&quot; title=&quot;验证 HTTP Referer 字段&quot;&gt;&lt;/a&gt;验证 HTTP Referer 字段&lt;/h3&gt;&lt;p&gt; HTTP 头中有一个 Referer 字段，它记录了该 HTTP 请求的来源地址，对该地址进行判断，如果同源则通过验证，否则拒绝请求&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;refererCheck(req, res, next)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; referer = req.headers.referer;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; refererHost = (referer &amp;amp;&amp;amp; referer.replace(&lt;span class=&quot;regexp&quot;&gt;/https?:\/\//ig&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;).split(&lt;span class=&quot;string&quot;&gt;&quot;/&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) || &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; reg = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;RegExp&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;\\.&quot;&lt;/span&gt; + app.config.baseURI.replace(&lt;span class=&quot;regexp&quot;&gt;/\./g&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;\\.&quot;&lt;/span&gt;) + &lt;span class=&quot;string&quot;&gt;&quot;$&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!reg.test(refererHost))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        next();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;app.get(&lt;span class=&quot;string&quot;&gt;&#39;/api/test&#39;&lt;/span&gt;, utils.refererCheck, (req, res, next) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// dosomething&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; xxx;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以上，当请求&lt;code&gt;/api/test&lt;/code&gt;时，站点A会劫持User(c)的请求并判断请求referer来源，如果发现来源于站点，则会拒绝请求&lt;br&gt;
    
    </summary>
    
      <category term="Node" scheme="http://yoursite.com/categories/Node/"/>
    
    
      <category term="Node" scheme="http://yoursite.com/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>浅谈ES6新特性之promise篇</title>
    <link href="http://yoursite.com/2018/01/03/ES6-promise/"/>
    <id>http://yoursite.com/2018/01/03/ES6-promise/</id>
    <published>2018-01-03T14:03:30.000Z</published>
    <updated>2018-04-10T07:09:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JS单线程特性"><a href="#JS单线程特性" class="headerlink" title="JS单线程特性"></a>JS单线程特性</h2><p>浏览器（或者说JS引擎）执行JS的机制是基于事件循环。</p><p>由于JS是单线程，所以同一时间只能执行一个任务，其他任务就得排队，后续任务必须等到前一个任务结束才能开始执行。为了避免因为某些长时间任务造成的无意义等待，JS引入了异步的概念，用另一个线程来管理异步任务。</p><p>同步任务直接在主线程队列中顺序执行，而异步任务会进入另一个任务队列，不会阻塞主线程。等到主线程队列空了（执行完了）的时候，就会去异步队列查询是否有可执行的异步任务了（异步任务通常进入异步队列之后还要等一些条件才能执行，如ajax请求、文件读写），如果某个异步任务可以执行了便加入主线程队列，以此循环。</p><h2 id="回调金字塔"><a href="#回调金字塔" class="headerlink" title="回调金字塔"></a>回调金字塔</h2><p>一直以来，JavaScript处理异步都是以callback的方式，在callback的模型里边，我们假设需要执行一个异步队列，代码看起来可能像这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doSomethingAsync1(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    doSomethingAsync2(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        doSomethingAsync3(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            doSomethingAsync4(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                doSomethingAsync5(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="comment">// code...</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>可以发现一个问题，在回调函数嵌套层数不深的情况下，代码还算容易理解和维护，一旦嵌套层数加深，就会出现“回调金字塔”的问题。</p><p>近几年随着JavaScript开发模式的逐渐成熟，CommonJS规范顺势而生，其中就包括提出了Promise规范，Promise完全改变了js异步编程的写法，让异步编程变得十分的易于理解。<br><a id="more"></a></p><h2 id="promise对象"><a href="#promise对象" class="headerlink" title="promise对象"></a>promise对象</h2><blockquote><p>Promise 对象用于一个异步操作的最终完成（或失败）及其结果值的表示。(简单点说就是处理异步请求。我们经常会做些承诺，如果我赢了你就嫁给我，如果输了我就嫁给你之类的诺言。这就是promise的中文含义：诺言，一个成功，一个失败。)</p></blockquote><p>一个<code>promise</code>有以下几个状态：</p><ul><li>pending: 初始状态，成功或失败状态。</li><li>fulfilled: 意味着操作成功完成。</li><li>rejected: 意味着操作失败。</li></ul><p>pending 状态的 Promise 对象可能触发fulfilled 状态并传递一个值给相应的状态处理方法，也可能触发失败状态（rejected）并传递失败信息。当其中任一种情况出现时，Promise 对象的 then 方法绑定的处理方法（handlers ）就会被调用（then方法包含两个参数：onfulfilled 和 onrejected，它们都是 Function 类型。当Promise状态为fulfilled时，调用 then 的 onfulfilled 方法，当Promise状态为rejected时，调用 then 的 onrejected 方法， 所以在异步操作的完成和绑定处理方法之间不存在竞争）。</p><p>因为 <code>Promise.prototype.then</code> 和  <code>Promise.prototype.catch</code> 方法返回promise 对象， 所以它们可以被链式调用。</p><h3 id="Promise方法"><a href="#Promise方法" class="headerlink" title="Promise方法"></a>Promise方法</h3><p>首先附上一段代码，以此来理解Promise.all()、Promise.race()、Promise.resolve()、Promise.reject()方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'promise1 OK'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'promise2 OK'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> promise3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">'promise3 fail'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise2]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.all([promise1, promise2])执行成功：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;,res =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.all([promise1, promise2])执行失败：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([promise1, promise3]).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.all([promise1, promise3])执行成功：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;,res =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.all([promise1, promise3])执行失败：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([promise1, promise2]).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise1, promise2])执行成功：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;,res=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise1, promise2])执行失败：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([promise1, promise3]).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise1, promise3])执行成功：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;,res=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise1, promise3])执行失败：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([promise3, promise1]).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise3, promise1])执行成功：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;,res=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.dir(<span class="string">`promise.race([promise3, promise1])执行失败：<span class="subst">$&#123;res&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p><img src="/images/2018-01-03-ES6-promise/promise.png" alt="promise.all"></p><p>由以上代码及运行结果可见</p><h4 id="Promise-all-iterable"><a href="#Promise-all-iterable" class="headerlink" title="Promise.all(iterable)"></a>Promise.all(iterable)</h4><p>Promise.all方法用于将多个Promise实例，包装成一个新的Promise实例：<code>var p = Promise.all([promise1, promise2]);</code><br>该方法接受一个数组作为参数，p的状态由promise1、promise2决定，分两种情况：</p><ul><li>只有promise1、promise2的状态都变成fulfilled，p的状态才会变成fulfilled，此时promise1、promise2的返回值组成一个数组，传递给p的回调函数。</li><li>只要promise1、promise2之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</li></ul><h4 id="Promise-race-iterable"><a href="#Promise-race-iterable" class="headerlink" title="Promise.race(iterable)"></a>Promise.race(iterable)</h4><p>该方法同Promise.all()一样的是：也用于将多个Promise实例包装成一个新的Promise实例：<br><code>var p = Promise.race([promise1, promise3]); || var p = Promise.race([promise1, promise3]);</code><br>不同的是：<strong>当promise1、promise3里的任意一个promise被成功或失败后，父promise马上也会用子promise的成功返回值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象。</strong></p><h4 id="Promise-resolve-value"><a href="#Promise-resolve-value" class="headerlink" title="Promise.resolve(value)"></a>Promise.resolve(value)</h4><p>返回一个状态由给定value决定的Promise对象。如果该值是一个Promise对象，则直接返回该对象；如果该值是thenable(即，带有then方法的对象)，返回的Promise对象的最终状态由then方法执行决定；否则的话(该value为空，基本类型或者不带then方法的对象),返回的Promise对象状态为fulfilled，并且将该value传递给对应的then方法。通常而言，如果你不知道一个值是否是Promise对象，使用Promise.resolve(value) 来返回一个Promise对象,这样就能将该value以Promise对象形式使用。</p><h4 id="Promise-reject-reason"><a href="#Promise-reject-reason" class="headerlink" title="Promise.reject(reason)"></a>Promise.reject(reason)</h4><p>返回一个状态为失败的Promise对象，并将给定的失败信息传递给对应的处理方法</p><h3 id="Promise原型"><a href="#Promise原型" class="headerlink" title="Promise原型"></a>Promise原型</h3><h4 id="Promise-prototype-constructor"><a href="#Promise-prototype-constructor" class="headerlink" title="Promise.prototype.constructor"></a>Promise.prototype.constructor</h4><p>返回被创建的实例函数.  默认为 Promise 函数.</p><h4 id="Promise-prototype-then-onFulfilled-onRejected"><a href="#Promise-prototype-then-onFulfilled-onRejected" class="headerlink" title="Promise.prototype.then(onFulfilled, onRejected)"></a>Promise.prototype.then(onFulfilled, onRejected)</h4><p>添加解决(fulfillment)和拒绝(rejection)回调到当前 promise, 返回一个新的 promise, 将以回调的返回值来resolve.</p><h4 id="Promise-prototype-catch-onRejected"><a href="#Promise-prototype-catch-onRejected" class="headerlink" title="Promise.prototype.catch(onRejected)"></a>Promise.prototype.catch(onRejected)</h4><p>添加一个拒绝(rejection) 回调到当前 promise, 返回一个新的promise。当这个回调函数被调用，新 promise 将以它的返回值来resolve，否则如果当前promise 进入fulfilled状态，则以当前promise的完成结果作为新promise的完成结果.</p><p><strong>因为 Promise.prototype.then 和  Promise.prototype.catch 方法返回promise 对象， 所以它们可以被链式调用。</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;JS单线程特性&quot;&gt;&lt;a href=&quot;#JS单线程特性&quot; class=&quot;headerlink&quot; title=&quot;JS单线程特性&quot;&gt;&lt;/a&gt;JS单线程特性&lt;/h2&gt;&lt;p&gt;浏览器（或者说JS引擎）执行JS的机制是基于事件循环。&lt;/p&gt;
&lt;p&gt;由于JS是单线程，所以同一时间只能执行一个任务，其他任务就得排队，后续任务必须等到前一个任务结束才能开始执行。为了避免因为某些长时间任务造成的无意义等待，JS引入了异步的概念，用另一个线程来管理异步任务。&lt;/p&gt;
&lt;p&gt;同步任务直接在主线程队列中顺序执行，而异步任务会进入另一个任务队列，不会阻塞主线程。等到主线程队列空了（执行完了）的时候，就会去异步队列查询是否有可执行的异步任务了（异步任务通常进入异步队列之后还要等一些条件才能执行，如ajax请求、文件读写），如果某个异步任务可以执行了便加入主线程队列，以此循环。&lt;/p&gt;
&lt;h2 id=&quot;回调金字塔&quot;&gt;&lt;a href=&quot;#回调金字塔&quot; class=&quot;headerlink&quot; title=&quot;回调金字塔&quot;&gt;&lt;/a&gt;回调金字塔&lt;/h2&gt;&lt;p&gt;一直以来，JavaScript处理异步都是以callback的方式，在callback的模型里边，我们假设需要执行一个异步队列，代码看起来可能像这样：&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;doSomethingAsync1(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    doSomethingAsync2(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        doSomethingAsync3(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            doSomethingAsync4(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                doSomethingAsync5(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// code...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以发现一个问题，在回调函数嵌套层数不深的情况下，代码还算容易理解和维护，一旦嵌套层数加深，就会出现“回调金字塔”的问题。&lt;/p&gt;
&lt;p&gt;近几年随着JavaScript开发模式的逐渐成熟，CommonJS规范顺势而生，其中就包括提出了Promise规范，Promise完全改变了js异步编程的写法，让异步编程变得十分的易于理解。&lt;br&gt;
    
    </summary>
    
      <category term="ES6" scheme="http://yoursite.com/categories/ES6/"/>
    
    
      <category term="ES6" scheme="http://yoursite.com/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>Vue学习笔记之父子组件通信</title>
    <link href="http://yoursite.com/2017/12/27/Vue-component-communication/"/>
    <id>http://yoursite.com/2017/12/27/Vue-component-communication/</id>
    <published>2017-12-27T13:29:29.000Z</published>
    <updated>2018-04-10T06:21:42.907Z</updated>
    
    <content type="html"><![CDATA[<h1 id="定义父子组件"><a href="#定义父子组件" class="headerlink" title="定义父子组件"></a>定义父子组件</h1><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">:message</span>=<span class="string">"msg"</span> @<span class="attr">contact</span>=<span class="string">"comFromChildren"</span>&gt;</span><span class="tag">&lt;/<span class="name">Welcome</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"userName"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">v-model</span>=<span class="string">"age"</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> @<span class="attr">click</span>=<span class="string">"addUser"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">'./welcome'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'hello'</span>,</span><br><span class="line">    components: &#123;Welcome&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            msg: <span class="string">'Welcome to Your Vue.js App'</span>,</span><br><span class="line">            userName: <span class="string">''</span>,</span><br><span class="line">            age: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        addUser() &#123;</span><br><span class="line">            <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">            self.$ajax(&#123;</span><br><span class="line">                url: <span class="string">'/api/user/addUser'</span>,</span><br><span class="line">                method: <span class="string">'post'</span>,</span><br><span class="line">                dataType: <span class="string">'json'</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    username: self.userName,</span><br><span class="line">                    age: self.age</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.data.success) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(res);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        comFromChildren: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'子组件传来信息啦'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="定义子组件"><a href="#定义子组件" class="headerlink" title="定义子组件"></a>定义子组件</h1><h2 id="HTML-1"><a href="#HTML-1" class="headerlink" title="HTML"></a>HTML</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--接受父组件传来的消息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JavaScript-1"><a href="#JavaScript-1" class="headerlink" title="JavaScript"></a>JavaScript</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">"welcome"</span>,</span><br><span class="line">    props: [<span class="string">'message'</span>],</span><br><span class="line">    created() &#123;</span><br><span class="line">        <span class="keyword">this</span>.$emit(<span class="string">'contact'</span>); <span class="comment">//通知父组件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="子组件接收父组件数据"><a href="#子组件接收父组件数据" class="headerlink" title="子组件接收父组件数据"></a>子组件接收父组件数据</h1><p><img src="/images/2017-12-27-Vue-component-communication/parentToChild.png" alt="父组件向子组件传值"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;定义父子组件&quot;&gt;&lt;a href=&quot;#定义父子组件&quot; class=&quot;headerlink&quot; title=&quot;定义父子组件&quot;&gt;&lt;/a&gt;定义父子组件&lt;/h1&gt;&lt;h2 id=&quot;HTML&quot;&gt;&lt;a href=&quot;#HTML&quot; class=&quot;headerlink&quot; title=&quot;HTML&quot;&gt;&lt;/a&gt;HTML&lt;/h2&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;hello&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;Welcome&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;:message&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;msg&quot;&lt;/span&gt; @&lt;span class=&quot;attr&quot;&gt;contact&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;comFromChildren&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;Welcome&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;username&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;v-model&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;userName&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;input&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;age&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;v-model&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;age&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;br&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;javascript:;&quot;&lt;/span&gt; @&lt;span class=&quot;attr&quot;&gt;click&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;addUser&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;提交&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;form&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;JavaScript&quot;&gt;&lt;a href=&quot;#JavaScript&quot; class=&quot;headerlink&quot; title=&quot;JavaScript&quot;&gt;&lt;/a&gt;JavaScript&lt;/h2&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; Welcome &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;./welcome&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    name: &lt;span class=&quot;string&quot;&gt;&#39;hello&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    components: &amp;#123;Welcome&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    data() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            msg: &lt;span class=&quot;string&quot;&gt;&#39;Welcome to Your Vue.js App&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            userName: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            age: &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    methods: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        addUser() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; self = &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.$ajax(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                url: &lt;span class=&quot;string&quot;&gt;&#39;/api/user/addUser&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                method: &lt;span class=&quot;string&quot;&gt;&#39;post&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dataType: &lt;span class=&quot;string&quot;&gt;&#39;json&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                data: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    username: self.userName,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    age: self.age&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).then(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;res&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (res.data.success) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(res);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        comFromChildren: &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(&lt;span class=&quot;string&quot;&gt;&#39;子组件传来信息啦&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Vue" scheme="http://yoursite.com/categories/Vue/"/>
    
    
      <category term="Vue" scheme="http://yoursite.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>webpack部署过程中遇到的问题</title>
    <link href="http://yoursite.com/2017/12/05/webpack-config/"/>
    <id>http://yoursite.com/2017/12/05/webpack-config/</id>
    <published>2017-12-05T09:39:11.000Z</published>
    <updated>2018-04-10T06:20:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>今天webpack部署新接手的项目的时候，<code>npm install</code> 好像加载不了<code>package.json</code>里面指定的依赖包！<br><img src="/images/2017-12-05-webpack-config/webpack-error-1.png" alt="问题样式"><br>以至于项目在编译过程中有些静态资源文件不能require，翻阅各种文档，均不能解决，头疼……<br><a id="more"></a></p><h2 id="暂时解决方案"><a href="#暂时解决方案" class="headerlink" title="暂时解决方案"></a>暂时解决方案</h2><p>从其他同事处拷贝了安装好的依赖包，放到项目代码中<br>依然有问题，because……同事的操作系统是Windows，所以拷贝之后，依然有些包不能用：<br><img src="/images/2017-12-05-webpack-config/webpack-error-2.png" alt="问题样式"><br>根据报错提示命令执行，终于解决：</p><blockquote><p>暂时留坑在这里，等调试完项目之后再来回顾该问题 /(ㄒoㄒ)/~~</p></blockquote><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>终于想起还有这个坑没填……依赖包安装不上完全是因为那些包都是私有包的问题……</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;今天webpack部署新接手的项目的时候，&lt;code&gt;npm install&lt;/code&gt; 好像加载不了&lt;code&gt;package.json&lt;/code&gt;里面指定的依赖包！&lt;br&gt;&lt;img src=&quot;/images/2017-12-05-webpack-config/webpack-error-1.png&quot; alt=&quot;问题样式&quot;&gt;&lt;br&gt;以至于项目在编译过程中有些静态资源文件不能require，翻阅各种文档，均不能解决，头疼……&lt;br&gt;
    
    </summary>
    
      <category term="webpack" scheme="http://yoursite.com/categories/webpack/"/>
    
    
      <category term="webpack" scheme="http://yoursite.com/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>MacOS 下配置Apache本地域名服务器</title>
    <link href="http://yoursite.com/2017/12/01/MacOS-Apache/"/>
    <id>http://yoursite.com/2017/12/01/MacOS-Apache/</id>
    <published>2017-12-01T03:17:29.000Z</published>
    <updated>2018-04-10T06:20:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求来源"><a href="#需求来源" class="headerlink" title="需求来源"></a>需求来源</h2><p>在开发项目的过程中，遇到需要经过域名访问资源来进行debug的场景，但项目是静态资源项目，没有本地服务。SO，想到了通过配置本地Apache域名访问资源的办法。</p><h2 id="实施过程"><a href="#实施过程" class="headerlink" title="实施过程"></a>实施过程</h2><h3 id="配置本地hosts"><a href="#配置本地hosts" class="headerlink" title="配置本地hosts"></a>配置本地hosts</h3><p><code>vi /etc/hosts</code>，配置自己预期的域名到hosts文件<br><img src="/images/2017-12-01-MacOS-Apache/hosts.png" alt="hosts"><br><a id="more"></a></p><h3 id="开启Apache虚拟主机功能"><a href="#开启Apache虚拟主机功能" class="headerlink" title="开启Apache虚拟主机功能"></a>开启Apache虚拟主机功能</h3><p><code>vi /etc/apache2/httpd.conf</code>打开Apache配置文件，找到<code>Include /private/etc/apache2/extra/httpd-vhosts.conf</code>，放开注释，开启虚拟主机功能:<br><img src="/images/2017-12-01-MacOS-Apache/openvirtual.png" alt="virtual"></p><p><code>vi /etc/apache2/extra/httpd-vhosts.conf</code>配置虚拟主机：</p><p><img src="/images/2017-12-01-MacOS-Apache/virtualhost.png" alt="virtualhost"></p><h3 id="启动Apache服务，域名访问项目"><a href="#启动Apache服务，域名访问项目" class="headerlink" title="启动Apache服务，域名访问项目"></a>启动Apache服务，域名访问项目</h3><p><code>sudo apachectl start</code>，好了，现在可以通过域名访问项目资源了：<br><img src="/images/2017-12-01-MacOS-Apache/load.png" alt="virtualhost"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;需求来源&quot;&gt;&lt;a href=&quot;#需求来源&quot; class=&quot;headerlink&quot; title=&quot;需求来源&quot;&gt;&lt;/a&gt;需求来源&lt;/h2&gt;&lt;p&gt;在开发项目的过程中，遇到需要经过域名访问资源来进行debug的场景，但项目是静态资源项目，没有本地服务。SO，想到了通过配置本地Apache域名访问资源的办法。&lt;/p&gt;
&lt;h2 id=&quot;实施过程&quot;&gt;&lt;a href=&quot;#实施过程&quot; class=&quot;headerlink&quot; title=&quot;实施过程&quot;&gt;&lt;/a&gt;实施过程&lt;/h2&gt;&lt;h3 id=&quot;配置本地hosts&quot;&gt;&lt;a href=&quot;#配置本地hosts&quot; class=&quot;headerlink&quot; title=&quot;配置本地hosts&quot;&gt;&lt;/a&gt;配置本地hosts&lt;/h3&gt;&lt;p&gt;&lt;code&gt;vi /etc/hosts&lt;/code&gt;，配置自己预期的域名到hosts文件&lt;br&gt;&lt;img src=&quot;/images/2017-12-01-MacOS-Apache/hosts.png&quot; alt=&quot;hosts&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="服务器" scheme="http://yoursite.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="Apache" scheme="http://yoursite.com/tags/Apache/"/>
    
  </entry>
  
  <entry>
    <title>线上问题日志定位手段</title>
    <link href="http://yoursite.com/2017/11/30/online-problem-logs/"/>
    <id>http://yoursite.com/2017/11/30/online-problem-logs/</id>
    <published>2017-11-30T03:50:30.000Z</published>
    <updated>2018-04-10T06:31:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote><p>项目在上线上环境之后，由于项目部署在服务器上，发生问题时本地无法debug，因此日志变得尤为重要。监控线上日志也成为线上问题定位的有效手段之一</p></blockquote><h2 id="日志监控"><a href="#日志监控" class="headerlink" title="日志监控"></a>日志监控</h2><p>以Linux系统下的项目部署为例，首先进入项目线上部署服务器，找到项目路径以及日志文件生成路径：<br><a id="more"></a><br><img src="/images/2017-11-30-online-problem-logs/1.png" alt="Alt text"></p><p>找到日志之后，就可以对指定级别的日志文件进行实时监控啦。一般发生问题时该监控error日志，本文以info日志为例：<br><img src="/images/2017-11-30-online-problem-logs/2.png" alt="Alt text"></p><p>然后进入软件系统进行相应操作，即可看见操作产生的对应日志了</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;项目在上线上环境之后，由于项目部署在服务器上，发生问题时本地无法debug，因此日志变得尤为重要。监控线上日志也成为线上问题定位的有效手段之一&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;日志监控&quot;&gt;&lt;a href=&quot;#日志监控&quot; class=&quot;headerlink&quot; title=&quot;日志监控&quot;&gt;&lt;/a&gt;日志监控&lt;/h2&gt;&lt;p&gt;以Linux系统下的项目部署为例，首先进入项目线上部署服务器，找到项目路径以及日志文件生成路径：&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux下查找包含指定内容的文件</title>
    <link href="http://yoursite.com/2017/11/30/Linux-find/"/>
    <id>http://yoursite.com/2017/11/30/Linux-find/</id>
    <published>2017-11-29T16:00:00.000Z</published>
    <updated>2018-04-10T07:07:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h2><p>在<code>hexo</code>上发布第一篇文章之后，对文章进行了分类和打标，当我点击分类标签查看该下面的文章是，惊奇的发现分类的样式有点小瑕疵。你知道的，强迫症肯定受不了，于是……审查元素，想对不满意的地方进行样式调整。OK，成功找到有问题的样式标签，如图：<br><img src="/images/2017-11-30-Linux-find/1.png" alt="问题样式"></p><p>嗯，可以准备下手修改样式了！but……这个样式表在哪里？翻遍了文件夹都没找到对应的这个<code>main.css</code>啊！没关系，接下来该我们本文的主角出场了<br><a id="more"></a></p><h2 id="find命令"><a href="#find命令" class="headerlink" title="find命令"></a>find命令</h2><p>以本人对Linux模糊的记忆，搜索到了强悍的find命令<code>find .|xargs grep -ri &quot;xxx&quot;</code>：其中<code>|</code>表示将上一次的<code>find</code>指令执行得到的结果交由下一个指令继续执行。执行该完整指令，good，找到了一大堆文件：<br><img src="/images/2017-11-30-Linux-find/2.png" alt="find"><br>修改样式，上传，查看blog样式，perfect，手工！</p><h2 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h2><p>为了省去本文的标题、分类、标签等一系列配置，我打算直接复用上一篇文章的配置。这样的话我首先用<code>vim</code>命令新建了该文章的文件<strong>Linux.md</strong>，然后<code>cat xx.md &gt; Linux.md</code>把<strong>xx</strong>文件的内容复制到了该文件</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;需求背景&quot;&gt;&lt;a href=&quot;#需求背景&quot; class=&quot;headerlink&quot; title=&quot;需求背景&quot;&gt;&lt;/a&gt;需求背景&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;hexo&lt;/code&gt;上发布第一篇文章之后，对文章进行了分类和打标，当我点击分类标签查看该下面的文章是，惊奇的发现分类的样式有点小瑕疵。你知道的，强迫症肯定受不了，于是……审查元素，想对不满意的地方进行样式调整。OK，成功找到有问题的样式标签，如图：&lt;br&gt;&lt;img src=&quot;/images/2017-11-30-Linux-find/1.png&quot; alt=&quot;问题样式&quot;&gt;&lt;/p&gt;
&lt;p&gt;嗯，可以准备下手修改样式了！but……这个样式表在哪里？翻遍了文件夹都没找到对应的这个&lt;code&gt;main.css&lt;/code&gt;啊！没关系，接下来该我们本文的主角出场了&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
</feed>
